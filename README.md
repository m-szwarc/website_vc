# Website Version Controller
PHP script that makes switching versions of webpage easy.  
The provided code allows you to decide which website version to choose simply by defining appropriate constant. I have provided you with template needed to write full system based on database data - only thing to do is to add code fetching data from your DB. Already written code checks for any missing files or inexistant versions.
# License
Code is provided with GNU GPLv3 license. Feel free to modify and redistribute it!  
For full license text, look at LICENCE.md
# Preparing VC to use
Code available on GitHub is already configured for a simple use scenario. You can simply copy all your website files to `versions` subdirectory. And voilÃ !
## Where to put my website files?
Your website files have to be copied to `versions/[version_name]/` directory. I have done my best to set all my code to be working transparently to you. Relative paths in `include` statements work as expected (`[version_name]` directory is considered as base path).
# Configuring VC
All configuration data is stored in `vc_user.php` file. Change settings by adjusting constants values.
## `DEFAULT_VERSION`
Default: `default`  
This constant stores default version to use. In default combination this field determines included version. It can be overwritten for a specific user by function `getVersionFromKeyPair()` (see below).
## `ERROR_ON_INEXISTANT_VERSION`
Default: `false`  
When the script tries to load a non-existing version of your site, it can print an error message (on `true`) or redirect to version `DEFAULT_VERSION` (on `false`).
## `VERSIONS_DIRECTORY`
Default: `versions/`  
Defines directory with alternative website versions. Value must end with slash (`/`).
## `ROOT_FILE`
Default: `index.php`  
Stores the main file's name. Main file is included by a script. Path from URL is available in `$_GET['path']` variable (for example when requesting `http://example.com/somefile?foo=bar`, your file will behave like when requesting `http://example.com/ROOT_FILE?path=somefile&foo=bar`).
## `SERIAL_KEY_COOKIE_NAME` and `RANDOM_KEY_COOKIE_NAME`
Default: `skey` and `rkey` respectively  
These two constants define names of cookies holding two 32-byte keys. The keypair can be used to identify particular clients. Serial key can be generated by your code. Delete function `getNextSerialKey()` (see below) from file `vc_user.php` to make it random.
## `STATUS_PAGE_ENABLED` and `STATUS_PAGE_URL`
Default: `false` and `vc_status` respectively  
With these constants you can enable simple status page that shows current configuration of the Version Controller. Visit page with URL stored in second constant to display that page (eg. `http://example.com/vc_status`) By default disabled.
## `DISABLE_SITE`
Default: `enable`  
With these settings you can disable whole site for all users or all except some group (for example for maintenance). Set `DISABLE_SITE` to `disable_all` if you want to completely disable site, or `disable_partial` if you want to give access only to group of users. They can access site by having special cookie (see below). 
## `DISABLE_PASS_COOKIE_NAME` and `DISABLE_PASS_COOKIE_VALUE`
Default: `dkey` and `1234` respectively  
They define a special cookie that gives access to *partially locked* website. Only users having `DISABLE_PASS_COOKIE_NAME` set to `DISABLE_PASS_COOKIE_VALUE` will be perimtted to view your site.
## `DISABLE_REASON`
Default: empty  
Content of `DISABLE_REASON` will show up under the *This website is disabled* header.
## `ENABLE_DEBUG`
Default: `false`  
When debug is enabled, there will be shown some data such as session keypair, loaded site version and file, contents of `$_GET` array under each HTML or PHP document.
## `USE_COOKIES`
Default: `true`  
Cookies are used to save session keypair. You can use the keys to identify your visitors. Disabling cookies disable session keys generation too.
# Additional functions
The additional functions aren't necessary for the script to work. You can even delete them. But they are supposed to be used as connector to database to store user-version pairs. For example you have 10 testers who should use `beta` version, but the rest of your users should see the `default` site.
## `string getVersionFromKeyPair(string[])`
Argument: Key pair (\[0\] => serial, \[1\] => random)  
Returns: Version name for those keys  
Here you can overwrite the `DEFAULT_VERSION` setting for each user separately.
## `string getNextSerialKey()`
Returns: 64 characters long string consisting of hex digits  
Generate serial key for a new session here. If deleted, serial key would be randomized.
## `void saveSessionKeyPair(string[])`
Argument: Key pair (\[0\] => serial, \[1\] => random)  
You can save the keypair to database (eg. to ensure that keys are unique).
## `bool isSessionKeyPairValid(string[])`
Argument: Key pair (\[0\] => serial, \[1\] => random)  
Returns: Whether the keypair is valid for use (eg. unique)
# Used libraries
* *Random Compatibility Library* by Paragon Initiative Enterprises (https://github.com/paragonie/random_compat/)
- - -
*Website Version Controller*
Copyright 2018, Marcin Szwarc
